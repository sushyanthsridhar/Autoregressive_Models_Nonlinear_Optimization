import numpy as np
import pandas as pd
from statsmodels.tsa.seasonal import seasonal_decompose
from statsmodels.tsa.holtwinters import ExponentialSmoothing
import matplotlib.pyplot as plt
import sys

def load_data_from_file(file_path):
    try:
        data = pd.read_csv(file_path)
        if 'Orders' not in data.columns or 'Date' not in data.columns:
            raise ValueError("CSV file must contain 'Date' and 'Orders' columns.")
        data['Date'] = pd.to_datetime(data['Date'])
        data.set_index('Date', inplace=True)
        return data
    except FileNotFoundError:
        print(f"Error: File not found at {file_path}.")
        sys.exit(1)
    except ValueError as ve:
        print(f"Error: {ve}")
        sys.exit(1)

def perform_seasonal_decomposition(ts):
    decomposition = seasonal_decompose(ts, model='additive', period=12)
    return decomposition.trend, decomposition.seasonal, decomposition.resid

def forecast_holt_winters(ts, steps=36):
    model = ExponentialSmoothing(ts, seasonal_periods=12, trend='add', seasonal='add')
    model_fit = model.fit()
    return model_fit, model_fit.forecast(steps=steps)

def plot_results(ts, trend, seasonal, fitted_values, forecast):
    plt.figure(figsize=(12, 6))
    plt.plot(ts, label='Original Data', marker='o')
    plt.plot(trend, label='Trend', linestyle='--')
    plt.plot(seasonal, label='Seasonal', linestyle='--')
    plt.plot(fitted_values, label='Fitted Values', linestyle='--')
    plt.plot(forecast, label='Forecast', marker='x')
    plt.title('Seasonal Decomposition and Forecast')
    plt.xlabel('Year')
    plt.ylabel('Order Amount')
    plt.legend()
    plt.grid(True)
    plt.tight_layout()
    plt.show()

def main(file_path):
    ts = load_data_from_file(file_path)
    trend, seasonal, residual = perform_seasonal_decomposition(ts)
    model_fit, forecast = forecast_holt_winters(ts)
    plot_results(ts, trend, seasonal, model_fit.fittedvalues, forecast)

if __name__ == "__main__":
    file_path = input("Enter the path to your CSV file: ").strip()
    main(file_path)
